<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA„É©„ÉÉ„Ç∑„É•Ôºö„Çª„É≥„Éà„É©„É´„Éâ„Ç∞„Éû</title>
    <style>
        /* --- CSSÔºà„Éá„Ç∂„Ç§„É≥Ôºâ --- */
        :root {
            --primary-bg: #1a1a2e; --secondary-bg: #16213e; --accent-color: #e94560;
            --text-color: #e0e0e0; --highlight-color: #53a8b6; --correct-color: #4caf50;
            --wrong-color: #f44336;
        }
        body {
            font-family: 'Helvetica', 'Arial', sans-serif; background-color: var(--primary-bg);
            color: var(--text-color); display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px 0; text-align: center;
        }
        #game-container {
            background-color: var(--secondary-bg); padding: 30px; border-radius: 20px;
            box-shadow: 0 0 25px rgba(227, 20, 100, 0.5); width: 90%; max-width: 600px;
        }
        h1 { color: #e2703a; margin-bottom: 20px; }
        #game-info {
            display: flex; justify-content: space-around; margin-bottom: 20px; font-size: 1.2em;
        }
        .problem-set {
            margin: 15px 0; display: grid; grid-template-columns: 1fr 2fr; gap: 15px; align-items: center;
        }
        .label { font-size: 1.5em; font-weight: bold; text-align: right; }
        #dna-display {
            font-size: 1.8em; font-weight: bold; letter-spacing: 5px; padding: 10px;
            background-color: #0f3460; border-radius: 10px; color: var(--highlight-color);
        }
        .answer-input {
            width: 95%; padding: 10px; font-size: 1.2em; text-align: center;
            border: 2px solid var(--highlight-color); background-color: var(--primary-bg);
            color: var(--text-color); border-radius: 10px; text-transform: uppercase;
            transition: box-shadow 0.3s;
        }
        .answer-input.active-input { box-shadow: 0 0 15px var(--highlight-color); }
        .control-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .game-button {
            padding: 15px 20px; font-size: 1em; font-weight: bold; cursor: pointer;
            border: none; border-radius: 10px; transition: all 0.2s;
        }
        #submit-button { background-color: var(--accent-color); color: white; }
        #submit-button:hover { background-color: #c73049; }
        #next-question-button { background-color: var(--highlight-color); color: white; display: none; } /* Êñ∞„Åó„ÅÑ„Éú„Çø„É≥ */
        #next-question-button:hover { background-color: #3a8a9a; }
        #toggle-codon-button { background-color: #0f3460; color: var(--highlight-color); }
        #toggle-codon-button:hover { background-color: #1a4a8a; }
        #reset-button { background-color: var(--correct-color); color: white; display: none; }
        #reset-button:hover { background-color: #388e3c; }
        #input-form { margin-top: 25px; display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; }
        .base-button { padding: 20px; font-size: 1.5em; font-weight: bold; background-color: #0f3460; color: var(--highlight-color); }
        #delete-button { background-color: #4a4a5e; }
        #feedback { margin-top: 20px; font-size: 1.2em; height: 50px; }
        #codon-modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7);
            align-items: flex-start; justify-content: center; padding-top: 5vh;
        }
        #codon-content {
            background-color: var(--secondary-bg); padding: 20px; border-radius: 15px;
            width: 95%; max-width: 800px; max-height: 85vh; overflow-y: auto;
        }
        #codon-table { width: 100%; border-collapse: collapse; }
        #codon-table th, #codon-table td {
            border: 1px solid var(--highlight-color); padding: 5px;
            font-size: 0.8em; text-align: center; vertical-align: middle;
        }
        #codon-table th { background-color: #0f3460; position: sticky; top: -1px; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>DNA„É©„ÉÉ„Ç∑„É• üß¨ „Çª„É≥„Éà„É©„É´„Éâ„Ç∞„Éû</h1>
        <div id="game-info"><span id="score">„Çπ„Ç≥„Ç¢: 0</span><span id="lives">„É©„Ç§„Éï: ‚ô•‚ô•‚ô•</span></div>
        <div class="problem-set"><span class="label">DNA</span><span id="dna-display">TAC</span></div>
        <div class="problem-set"><label for="mrna-input" class="label">mRNA</label><input type="text" id="mrna-input" class="answer-input" readonly></div>
        <div class="problem-set"><label for="trna-input" class="label">tRNA</label><input type="text" id="trna-input" class="answer-input" readonly></div>
        <div class="problem-set"><label for="amino-acid-input" class="label">„Ç¢„Éü„ÉéÈÖ∏</label><input type="text" id="amino-acid-input" class="answer-input" readonly></div>
        <div id="input-form">
            <button class="game-button base-button" data-type="base">A</button><button class="game-button base-button" data-type="base">T</button>
            <button class="game-button base-button" data-type="base">C</button><button class="game-button base-button" data-type="base">G</button>
            <button class="game-button base-button" data-type="base">U</button><button id="delete-button" class="game-button base-button">ÂâäÈô§</button>
        </div>
        <div class="control-buttons">
            <button id="submit-button" class="game-button">Ê±∫ÂÆö</button>
            <button id="next-question-button" class="game-button">Ê¨°„ÅÆÂïèÈ°å„Å∏</button> <button id="toggle-codon-button" class="game-button">„Ç≥„Éâ„É≥Ë°®</button>
            <button id="reset-button" class="game-button">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶ÔºÅ</button>
        </div>
        <div id="feedback"></div>
    </div>
    <div id="codon-modal">
        <div id="codon-content"><h2>mRNA „Ç≥„Éâ„É≥Ë°®</h2><table id="codon-table"></table><p style="margin-top: 15px;">ÔºàÈñâ„Åò„Çã„Å´„ÅØË°®„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØÔºâ</p></div>
    </div>

    <script>
    // --- JavaScript ---
    const rules = { dnaToMrna: {'A': 'U', 'T': 'A', 'C': 'G', 'G': 'C'}, mrnaToTrna: {'A': 'U', 'U': 'A', 'C': 'G', 'G': 'C'} };
    const codonTable = { 'UUU': '„Éï„Çß„Éã„É´„Ç¢„É©„Éã„É≥', 'UUC': '„Éï„Çß„Éã„É´„Ç¢„É©„Éã„É≥', 'UUA': '„É≠„Ç§„Ç∑„É≥', 'UUG': '„É≠„Ç§„Ç∑„É≥', 'UCU': '„Çª„É™„É≥', 'UCC': '„Çª„É™„É≥', 'UCA': '„Çª„É™„É≥', 'UCG': '„Çª„É™„É≥', 'UAU': '„ÉÅ„É≠„Ç∑„É≥', 'UAC': '„ÉÅ„É≠„Ç∑„É≥', 'UAA': 'ÁµÇÊ≠¢', 'UAG': 'ÁµÇÊ≠¢', 'UGU': '„Ç∑„Çπ„ÉÜ„Ç§„É≥', 'UGC': '„Ç∑„Çπ„ÉÜ„Ç§„É≥', 'UGA': 'ÁµÇÊ≠¢', 'UGG': '„Éà„É™„Éó„Éà„Éï„Ç°„É≥', 'CUU': '„É≠„Ç§„Ç∑„É≥', 'CUC': '„É≠„Ç§„Ç∑„É≥', 'CUA': '„É≠„Ç§„Ç∑„É≥', 'CUG': '„É≠„Ç§„Ç∑„É≥', 'CCU': '„Éó„É≠„É™„É≥', 'CCC': '„Éó„É≠„É™„É≥', 'CCA': '„Éó„É≠„É™„É≥', 'CCG': '„Éó„É≠„É™„É≥', 'CAU': '„Éí„Çπ„ÉÅ„Ç∏„É≥', 'CAC': '„Éí„Çπ„ÉÅ„Ç∏„É≥', 'CAA': '„Ç∞„É´„Çø„Éü„É≥', 'CAG': '„Ç∞„É´„Çø„Éü„É≥', 'CGU': '„Ç¢„É´„ÇÆ„Éã„É≥', 'CGC': '„Ç¢„É´„ÇÆ„Éã„É≥', 'CGA': '„Ç¢„É´„ÇÆ„Éã„É≥', 'CGG': '„Ç¢„É´„ÇÆ„Éã„É≥', 'AUU': '„Ç§„ÇΩ„É≠„Ç§„Ç∑„É≥', 'AUC': '„Ç§„ÇΩ„É≠„Ç§„Ç∑„É≥', 'AUA': '„Ç§„ÇΩ„É≠„Ç§„Ç∑„É≥', 'AUG': '„É°„ÉÅ„Ç™„Éã„É≥(ÈñãÂßã)', 'ACU': '„Éà„É¨„Ç™„Éã„É≥', 'ACC': '„Éà„É¨„Ç™„Éã„É≥', 'ACA': '„Éà„É¨„Ç™„Éã„É≥', 'ACG': '„Éà„É¨„Ç™„Éã„É≥', 'AAU': '„Ç¢„Çπ„Éë„É©„ÇÆ„É≥', 'AAC': '„Ç¢„Çπ„Éë„É©„ÇÆ„É≥', 'AAA': '„É™„Ç∏„É≥', 'AAG': '„É™„Ç∏„É≥', 'AGU': '„Çª„É™„É≥', 'AGC': '„Çª„É™„É≥', 'AGA': '„Ç¢„É´„ÇÆ„Éã„É≥', 'AGG': '„Ç¢„É´„ÇÆ„Éã„É≥', 'GUU': '„Éê„É™„É≥', 'GUC': '„Éê„É™„É≥', 'GUA': '„Éê„É™„É≥', 'GUG': '„Éê„É™„É≥', 'GCU': '„Ç¢„É©„Éã„É≥', 'GCC': '„Ç¢„É©„Éã„É≥', 'GCA': '„Ç¢„É©„Éã„É≥', 'GCG': '„Ç¢„É©„Éã„É≥', 'GAU': '„Ç¢„Çπ„Éë„É©„ÇÆ„É≥ÈÖ∏', 'GAC': '„Ç¢„Çπ„Éë„É©„ÇÆ„É≥ÈÖ∏', 'GAA': '„Ç∞„É´„Çø„Éü„É≥ÈÖ∏', 'GAG': '„Ç∞„É´„Çø„Éü„É≥ÈÖ∏', 'GGU': '„Ç∞„É™„Ç∑„É≥', 'GGC': '„Ç∞„É™„Ç∑„É≥', 'GGA': '„Ç∞„É™„Ç∑„É≥', 'GGG': '„Ç∞„É™„Ç∑„É≥' };
    const aminoAcids = [...new Set(Object.values(codonTable))].filter(acid => acid !== 'ÁµÇÊ≠¢' && acid !== '„É°„ÉÅ„Ç™„Éã„É≥(ÈñãÂßã)');
    const elements = { score: document.getElementById('score'), lives: document.getElementById('lives'), dnaDisplay: document.getElementById('dna-display'), mrnaInput: document.getElementById('mrna-input'), trnaInput: document.getElementById('trna-input'), aminoAcidInput: document.getElementById('amino-acid-input'), submitButton: document.getElementById('submit-button'), nextQuestionButton: document.getElementById('next-question-button'), toggleCodonButton: document.getElementById('toggle-codon-button'), resetButton: document.getElementById('reset-button'), feedback: document.getElementById('feedback'), codonModal: document.getElementById('codon-modal'), codonTable: document.getElementById('codon-table'), inputForm: document.getElementById('input-form'), answerInputs: document.querySelectorAll('.answer-input'), deleteButton: document.getElementById('delete-button'), baseButtons: document.querySelectorAll('[data-type="base"]') };
    let state = { score: 0, lives: 3, currentDna: '', correctAnswers: {}, activeInput: null };

    function generateCodonTable() { /* ... (Â§âÊõ¥„Å™„Åó) ... */ const bases = ['U', 'C', 'A', 'G']; let tableHTML = '<thead><tr><th></th>'; bases.forEach(base => tableHTML += `<th>${base}</th>`); tableHTML += '<th></th></tr></thead><tbody>'; bases.forEach(firstBase => { tableHTML += `<tr><th>${firstBase}</th>`; bases.forEach(secondBase => { let cellContent = ''; bases.forEach(thirdBase => { const codon = firstBase + secondBase + thirdBase; const aminoAcid = codonTable[codon] || ''; cellContent += `<b>${codon}</b>: ${aminoAcid.replace('(ÈñãÂßã)', '')}<br>`; }); tableHTML += `<td>${cellContent}</td>`; }); tableHTML += `<th>${firstBase}</th></tr>`; }); tableHTML += '</tbody>'; elements.codonTable.innerHTML = tableHTML; }
    function updateDisplay() { elements.score.textContent = `„Çπ„Ç≥„Ç¢: ${state.score}`; elements.lives.textContent = `„É©„Ç§„Éï: ${'‚ô•'.repeat(state.lives)}`; }
    function setActiveInput(inputElement) { elements.answerInputs.forEach(el => el.classList.remove('active-input')); state.activeInput = inputElement; if(state.activeInput) state.activeInput.classList.add('active-input'); }
    
    function nextProblem() {
        let aminoAcid = '';
        do { const dnaBases = ['A', 'T', 'C', 'G']; state.currentDna = [1, 2, 3].map(() => dnaBases[Math.floor(Math.random() * 4)]).join(''); state.correctAnswers.mrna = Array.from(state.currentDna).map(b => rules.dnaToMrna[b]).join(''); aminoAcid = codonTable[state.correctAnswers.mrna]; } while (!aminoAcid || aminoAcid === 'ÁµÇÊ≠¢' || aminoAcid === '„É°„ÉÅ„Ç™„Éã„É≥(ÈñãÂßã)');
        state.correctAnswers.trna = Array.from(state.correctAnswers.mrna).map(b => rules.mrnaToTrna[b]).join('');
        state.correctAnswers.aminoAcid = aminoAcid;

        elements.dnaDisplay.textContent = state.currentDna;
        elements.answerInputs.forEach(el => { el.value = ''; el.disabled = false; });
        elements.feedback.textContent = '';
        
        elements.submitButton.style.display = 'inline-block';
        elements.nextQuestionButton.style.display = 'none';
        
        setActiveInput(elements.mrnaInput);
    }

    // --- ‚ñº‚ñº‚ñº checkAnswerÈñ¢Êï∞„Çí‰øÆÊ≠£ ‚ñº‚ñº‚ñº ---
    function checkAnswer() {
        const userMrna = elements.mrnaInput.value;
        const userTrna = elements.trnaInput.value;
        const userAmino = elements.aminoAcidInput.value;
        const isCorrect = userMrna === state.correctAnswers.mrna && userTrna === state.correctAnswers.trna && userAmino === state.correctAnswers.aminoAcid;

        if (isCorrect) {
            elements.feedback.textContent = "„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅüéâ";
            elements.feedback.style.color = 'var(--correct-color)';
            state.score += 100;
        } else {
            elements.feedback.innerHTML = `ÊÆãÂøµ...<br>Ê≠£Ëß£„ÅØ ${state.correctAnswers.mrna} / ${state.correctAnswers.trna} / ${state.correctAnswers.aminoAcid}`;
            elements.feedback.style.color = 'var(--wrong-color)';
            state.lives--;
        }

        updateDisplay();
        elements.answerInputs.forEach(el => el.disabled = true); // ÂÖ•ÂäõÊ¨Ñ„ÇíÁÑ°ÂäπÂåñ
        elements.submitButton.style.display = 'none'; // „ÄåÊ±∫ÂÆö„Äç„Éú„Çø„É≥„ÇíÈö†„Åô

        if (state.lives > 0) {
            elements.nextQuestionButton.style.display = 'inline-block'; // „ÄåÊ¨°„ÅÆÂïèÈ°å„Å∏„Äç„Éú„Çø„É≥„ÇíË°®Á§∫
        } else {
            gameOver();
        }
    }

    function gameOver() {
        elements.feedback.textContent = "„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ";
        elements.dnaDisplay.textContent = "FIN";
        elements.toggleCodonButton.style.display = 'none';
        elements.nextQuestionButton.style.display = 'none';
        elements.resetButton.style.display = 'inline-block';
    }

    function resetGame() {
        state.score = 0; state.lives = 3;
        updateDisplay();
        elements.toggleCodonButton.style.display = 'inline-block';
        elements.resetButton.style.display = 'none';
        nextProblem();
    }
    
    // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº (Â§âÊõ¥„Å™„Åó) ---
    elements.submitButton.addEventListener('click', checkAnswer);
    elements.nextQuestionButton.addEventListener('click', nextProblem); // NEW
    elements.resetButton.addEventListener('click', resetGame);
    elements.toggleCodonButton.addEventListener('click', () => { elements.codonModal.style.display = 'flex'; });
    elements.codonModal.addEventListener('click', (e) => { if (e.target === elements.codonModal) { elements.codonModal.style.display = 'none'; } });
    elements.answerInputs.forEach(input => input.addEventListener('click', (e) => setActiveInput(e.target)));
    elements.baseButtons.forEach(button => { button.addEventListener('click', (e) => { if (state.activeInput && state.activeInput.id !== 'amino-acid-input') { if (state.activeInput.value.length < 3) { state.activeInput.value += e.target.textContent; } } }); });
    elements.deleteButton.addEventListener('click', () => { if (state.activeInput) { state.activeInput.value = state.activeInput.value.slice(0, -1); } });
    aminoAcids.forEach(acid => { const button = document.createElement('button'); button.textContent = acid; button.className = 'game-button base-button amino-acid-button'; button.style.fontSize = acid.length > 5 ? '0.8em' : '1em'; elements.inputForm.appendChild(button); button.addEventListener('click', () => { if (state.activeInput && state.activeInput.id === 'amino-acid-input') { state.activeInput.value = acid; } }); });

    generateCodonTable();
    resetGame();
    </script>
</body>
</html>

